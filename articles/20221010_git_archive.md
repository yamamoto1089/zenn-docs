---
title: "Githubã®diffã¨archiveã§å·®åˆ†ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’æŠ½å‡ºã™ã‚‹"
emoji: "ğŸ““"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Github","archive"]
published: true
---

# ã¯ã˜ã‚ã«
ã€Œ**ä½œæ¥­ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªã‚¹ãƒˆåŒ–ã—ã¦ã»ã—ã„**ã€ãªã‚“ã¦ã“ã¨ã‚’è¨€ã‚ã‚Œã‚‹æ—¥ãŒæ¥ã‚‹ã¨ã¯æ€ã„ã¾ã›ã‚“ã§ã—ãŸã€‚  
ä¸€ä½“ãã‚“ãªã‚‚ã®ã‚’å‡ºã—ã¦ã©ã†ã™ã‚‹ã‚“ã ã€ãã‚‚ãã‚‚ãã®ä½œæ¥­ã¯ã“ã¡ã‚‰ãŒã‚„ã‚‰ãªã‘ã‚Œã°ã„ã‘ãªã„ã®ã‹ã€æ‰‹ä½œæ¥­ã§ã¯çµ¶å¯¾ã«ã‚„ã‚ŠãŸããªã„ã€‚ã€‚ã€‚  
ãã‚“ãªæ€ã„ã«é§†ã‚‰ã‚ŒãªãŒã‚‰ã‚°ã‚°ã£ã¦ã„ã‚‹ã¨Gitç®¡ç†ã§ãã¦ã„ã‚Œã°ãªã‚“ã¨ã‹ãªã‚‹ã¿ãŸã„ã§ã™ã­ã€‚  

ãã‚Œã«ã€ä½œæ¥­ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªã‚¹ãƒˆåŒ–ã—ãŸã„ã£ã¦æ„å¤–ã¨ã‚ã‚‹ã‚ã‚‹ã¿ãŸã„ã§ã™ã­ã€‚å‚™å¿˜éŒ²ã¨ã—ã¦è¨˜äº‹ã«ã—ã¾ã—ãŸã€‚  
Githubã®ã‚³ãƒãƒ³ãƒ‰ä¸€ç™ºã§å·®åˆ†ã‚’æŠ½å‡ºã—ã¾ã—ã‚‡ã†ã€‚  

# ã¨ã‚Šã‚ãˆãšå·®åˆ†ã‚’æŠ½å‡ºã™ã‚‹

**ã‚ã‚‹ãƒ–ãƒ©ãƒ³ãƒ**ã®**ã‚³ãƒŸãƒƒãƒˆID:A**ã‹ã‚‰**ã‚³ãƒŸãƒƒãƒˆID:B**ã¾ã§ã®å·®åˆ†ã‚’æŠ½å‡ºã—ãŸã„å ´åˆã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§æŠ½å‡ºã§ãã¾ã™ã€‚  
```
git archive {ãƒ–ãƒ©ãƒ³ãƒå} `git diff --name-only {ã‚³ãƒŸãƒƒãƒˆID:A} {ã‚³ãƒŸãƒƒãƒˆID:B}` -o {å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å}
```

ãªã®ã§ä¾‹ãˆã°ã€**develop**ãƒ–ãƒ©ãƒ³ãƒã®æœ€æ–°ã‹ã‚‰1ã¤å‰ã®å·®åˆ†ã‚’**archive.zip**ã«å‡ºåŠ›ã™ã‚‹å ´åˆã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚
```
git archive develop `git diff --name-only HEAD HEAD~1` -o archive.zip
```

## ä½•ã‚’ã‚„ã£ã¦ã‚‹ã®ï¼Ÿ

å¤§ããåˆ†ã‘ã‚‹ã¨ã€`git diff` ã¨ `git archive` ã§å½¹å‰²ã‚’åˆ†ã‘ã¦ã„ã¾ã™ã€‚  
### [git diff](https://git-scm.com/docs/git-diff)
ç‰¹å®šã®ã‚³ãƒŸãƒƒãƒˆã®é–“ã§ç™ºç”Ÿã—ãŸå·®åˆ†ã‚’æŠ½å‡ºã—ã¦ã„ã¾ã™ã€‚
ã¾ãŸã€`git diff` ã§ã¯ `--name-only` ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«åã ã‘ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚  

### [git archive](https://git-scm.com/docs/git-archive)
`git archive` ã§æŠ½å‡ºã•ã‚ŒãŸå·®åˆ†ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–(zipãƒ•ã‚¡ã‚¤ãƒ«åŒ–)ã—ã¦ã„ã¾ã™ã€‚  


# ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆã®å¯¾å‡¦
`git archive` ã§ããªã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã™ã€‚
```
fatal: pathspec '{ãƒ•ã‚¡ã‚¤ãƒ«å}' did not match any files
```

ã“ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã®åŸå› ãƒ•ã‚¡ã‚¤ãƒ«ã‚’[sedã‚³ãƒãƒ³ãƒ‰](https://tech-blog.rakus.co.jp/entry/20211022/sed)ã§é™¤å¤–ã™ã‚‹ã“ã¨ã§å¯¾å¿œã—ã¾ã™ã€‚
```
git archive {ãƒ–ãƒ©ãƒ³ãƒå} `git diff --name-only {ã‚³ãƒŸãƒƒãƒˆID:A} {ã‚³ãƒŸãƒƒãƒˆID:B}| sed '{é™¤å¤–ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«}'` -o {å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å}
```

ä¾‹ãˆã° **.DS_Store** ãƒ•ã‚¡ã‚¤ãƒ«ãŒåŸå› ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ã‚‹å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
```
git archive develop `git diff --name-only HEAD HEAD~2| sed '.DS_Store'` -o archive.zip
```

ã‚³ãƒãƒ³ãƒ‰ã®ä½µç”¨ã§ã ã„ã¶é•·ããªã‚Šã¾ã—ãŸãŒã€ã“ã‚Œã§ç›®çš„ã¯ã»ã¼é”æˆã§ãã¾ã—ãŸã€‚  

# æŠ½å‡ºã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’ãƒªã‚¹ãƒˆåŒ–

æŠ½å‡ºã•ã‚ŒãŸzipãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã®ãƒ‘ã‚¹ã‚’ãƒªã‚¹ãƒˆåŒ–ã—ã¾ã™ã€‚  
[zipinfo](https://4thsight.xyz/3761)ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦zipãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’1è¡Œãšã¤å‡ºåŠ›ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚  
```
zipinfo -1 {æŠ½å‡ºã—ãŸzipãƒ•ã‚¡ã‚¤ãƒ«} > {å‡ºåŠ›å…ˆãƒ•ã‚¡ã‚¤ãƒ«}
```
ä¾‹ãˆã°ã€ä»Šå›ã®archive.zipã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’result.txtã«å‡ºåŠ›ã™ã‚‹å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
```
zipinfo -1 archive.zip > result.txt
```

**zipinfo**ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ **-1** ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ãŒã€ã“ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§åœ§ç¸®ç‡ã‚„ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãªã©è©³ç´°å ´æƒ…å ±ã‚’å‡ºè‰²ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚  
**-x**ã‚’æŒ‡å®šã™ã‚Œã°ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å‡ºåŠ›ã‹ã‚‰é™¤å¤–ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚  

# æœ€é©åŒ–
ã“ã‚Œã§ã‚³ãƒŸãƒƒãƒˆAã‹ã‚‰ã‚³ãƒŸãƒƒãƒˆBã¾ã§ã®å·®åˆ†ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªã‚¹ãƒˆåŒ–ã§ãã¾ã—ãŸã€‚  
ãŸã  **.gitignore** ãªã©ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ãƒªã‚¹ãƒˆåŒ–ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€å¿…è¦ã«å¿œã˜ã¦ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  
**.gitignore**ã¯[.gitattributes](https://zenn.dev/woo_noo/articles/5fcee179d890d1174add)ã« `.gitignore export-ignore` ã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ã§archiveã®å¯¾è±¡å¤–ã«ã§ãã‚‹ã¿ãŸã„ã§ã™ã€‚  

ä»–ã«ã‚‚å¿…è¦ã«å¿œã˜ã¦ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šãã†ã§ã™ãŒã€å¤šããªã‘ã‚Œã°äººåŠ›ã§ã‚„ã£ã¦ã‚‚è‰¯ã„ã®ã‹ãªã¨æ€ã„ã¾ã™ã€‚  

# ãŠã‚ã‚Šã«
ã€Œä½œæ¥­ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªã‚¹ãƒˆåŒ–ã—ã¦ã»ã—ã„ã€ãªã‚“ã¦ã“ã¨ã‚’è¨€ã‚ã‚ŒãŸæ—¥ã«ã¯ã“ã®è¨˜äº‹ã‚’æ€ã„å‡ºã—ã¦ãã ã•ã„ã€‚  
æ¬¡ã¯ãŠå‰ã®ç•ªã§ã™ã€‚  

# ãã‚‚ãã‚‚
å·®åˆ†ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã ã‘ãªã‚‰ `git archive` ã®ãã ã‚Šã¯å¿…è¦ãªãã¦ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚ˆã‹ã£ãŸã€‚  
```
git diff --name-only {ã‚³ãƒŸãƒƒãƒˆID:A} {ã‚³ãƒŸãƒƒãƒˆID:B} > {å‡ºåŠ›å…ˆãƒ•ã‚¡ã‚¤ãƒ«}
```
# å‚è€ƒè¨˜äº‹
https://qiita.com/kaminaly/items/28f9cb4e680deb700833
https://rfs.jp/server/git/gite-lab/git-archive.html
https://zenn.dev/lamrongol/articles/d21f42c27495b3
