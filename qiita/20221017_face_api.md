# ã¯ã˜ã‚ã«
ã‚³ãƒ­ãƒŠç¦ãŒåã¾ã£ã¦ããŸã¨ã¯ã„ãˆã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹æ©Ÿä¼šã¯å¤šã„ã§ã™ã­ã€‚  
ZOOMã‚„GoogleMeetã§ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†éš›ã€è‡ªåˆ†ã®é¡”ã‚’å†™ã—ã¦ã„ã‚‹äººã‚‚å¤šã„ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ  

ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä¸­ã€ç”»é¢ã«æ˜ ã•ã‚Œã‚‹è‡ªåˆ†ã®ç„¡è¡¨æƒ…ã®é¡”ã€‚  
**ãªã‚“ã‹ç–²ã‚Œã¦ãªã„ï¼Ÿ**  
![hyoujou_shinda_me_woman.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/506401/9ab38f76-3345-d360-b721-e64393da0376.png)

ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä¸­ã€ç›¸æ§Œã‚’æ‰“ã¡ãªãŒã‚‰å¾®ç¬‘ã‚€è‡ªåˆ†ã®é¡”ã€‚  
**ãªã‚“ã‹ã†ã¾ãç¬‘ãˆã¦ãªããªã„ï¼Ÿ**  
![nihil_smile_man.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/506401/fe151677-696e-21b3-9dcb-f5327dc8c8b7.png)

ãã‚‚ãã‚‚è‡ªåˆ†ã®é¡”ã€‚  
**ãªã‚“ã‹è€ã‘ã¦ãªã„ï¼Ÿ**  
![pose_unzari_woman.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/506401/5ed79b46-b411-99bd-b517-39c696fc6e68.png)

ã€Œç„¡è¡¨æƒ…ã§ã„ã‚‹ã¤ã‚‚ã‚Šã§ã‚‚ä»–äººã‹ã‚‰ã—ãŸã‚‰æ€’ã£ã¦è¦‹ãˆã¦ã„ã‚‹ã‹ã‚‚ã€‚ã€‚ã€‚ã€  
ã€Œç¬‘ã£ã¦ã„ã‚‹ã¤ã‚‚ã‚Šã§ã‚‚ä»–äººã‹ã‚‰è¦‹ãŸã‚‰å¤‰ãªé¡”ã«è¦‹ãˆã¦ã‚‹ã‹ã‚‚ã€‚ã€‚ã€‚ã€  
ãã‚“ãªã“ã¨ã‚’è€ƒãˆå§‹ã‚ã‚‹ã¨è‡ªåˆ†ã®è¡¨æƒ…ãŒä»–äººã«ã©ã†è¦‹ãˆã¦ã„ã‚‹ã®ã‹æ°—ã«ãªã£ã¦å¤œã‚‚çœ ã‚Œã¾ã›ã‚“ã€‚  

ãã“ã§è€ƒãˆã¾ã—ãŸã€‚  
**è‡ªåˆ†ã®é¡”ã‚’AIã«èªè­˜ã•ã›ã¦ã©ã‚“ãªæ„Ÿæƒ…ã‹ã‚’åˆ¤å®šã—ã¦ã‚‚ã‚‰ãˆã°é¢ç™½ã„ã®ã§ã¯?**  
**ã¤ã„ã§ã«å¹´é½¢ã‚‚ä½•æ­³ã«è¦‹ãˆã‚‹ã‹åˆ¤å®šã—ã¦ã‚‚ã‚‰ãˆã°è‰¯ã„ã®ã§ã¯ï¼Ÿ**  

ä»Šå›ã®ã“ã®è¨˜äº‹ã§ã¯**face-api.js**ã‚’åˆ©ç”¨ã—ã¦ã€PCã®ã‚¤ãƒ³ã‚«ãƒ¡ãƒ©ã§æ’®å½±ã—ãŸè‡ªåˆ†ã®é¡”ã‚’è§£æã—ã¦ã‚‚ã‚‰ã„ã¾ã™ã€‚  

**æœ€çµ‚çš„ã«ä½œæˆã—ãŸã‚‚ã®ãŒã“ã¡ã‚‰ã«ãªã‚Šã¾ã™â†“**  
**https://merry-paprenjak-7d004b.netlify.app/** 

å…±åŒåŸ·ç­†è€…: @sarahlovesplum @ymmt1089

# ãã‚‚ãã‚‚face-api.jsã£ã¦ä½•ï¼Ÿ
**face-api.js** ã¯ã€é¡”æ¤œå‡ºãƒ»é¡”èªè­˜ã‚’è¡Œã†ãŸã‚ã®JavaScriptAPIã§ã™ã€‚  
ã‚³ã‚¢éƒ¨åˆ†ã¯tensorflow.jsï¼ˆtensorflow/tfjs-coreï¼‰ä¸Šã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚
[å…¬å¼ã®ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸](https://justadudewhohacks.github.io/face-api.js/face_and_landmark_detection)  

# æ‰‹é †

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
ğŸ“‚project
 â”œ ğŸ“‚models(å­¦ç¿’ãƒ¢ãƒ‡ãƒ«)
 â”œ ğŸ“„face-api.mim.js(face-apiãƒ©ã‚¤ãƒ–ãƒ©ãƒª)
 â”œ ğŸ“„index.html
 â”” ğŸ“„script.js

## å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
ã¾ãšã€**fase-api** ã®Githubã‹ã‚‰å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãŠãã¾ã™ã€‚  
ä»¥ä¸‹ãƒªãƒ³ã‚¯ã‹ã‚‰ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦modelsé…ä¸‹ã«é…ç½®ã—ã¾ã™ã€‚  
https://github.com/justadudewhohacks/face-api.js/tree/master/weights

### å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã®ç¨®é¡ã¨èª¬æ˜
ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸå­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚
ç”»åƒã¯å…¬å¼ã‹ã‚‰å¼•ç”¨: https://justadudewhohacks.github.io/face-api.js/docs/index.html

* **ssdMobilenetv**
  ![1.gif](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/506401/ded7aa29-2e24-82a9-e432-8346b104d9a3.gif)
  ç²¾åº¦ãŒé«˜ã„é¡”æ¤œå‡ºã€‚ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã¨ç²¾åº¦ã‚’å–å¾—ã€‚

* **tinyFaceDetector**
  detectSingleFace()ã§æ¤œå‡ºã—ãŸé¡”ã®ä¸­ã§ã€ã‚‚ã£ã¨ã‚‚ä¿¡é ¼åº¦ãŒé«˜ã„é¡”ã‚’1ã¤ã ã‘æ¤œå‡ºã—ã¾ã™ã€‚è¤‡æ•°äººã‚’æ¤œå‡ºã—ãŸã„å ´åˆã¯ã€tinyFaceDetectorã®detectAllFaces()ã§æ¤œå‡ºå¯èƒ½ã§ã™ã€‚  
  æ¨è«–ãŒé«˜é€Ÿãªé¡”æ¤œå‡ºã€‚ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã¨ç²¾åº¦ã‚’å–å¾—ã€‚

* **faceLandmark68Net**
  ![2.jpeg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/506401/56e7c795-8922-7a2b-6cd9-dead048f4ca8.jpeg)
  é¡”ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã‚’æ¤œå‡ºã€‚68å€‹ã®é¡”ã®ãƒã‚¤ãƒ³ãƒˆã‚’å–å¾—ã€‚

* **faceRecognitionNet**
  ![5.gif](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/506401/0c469234-cf24-0c35-87f1-bf19c63e4293.gif)
  2ã¤ã®é¡”ã®é¡ä¼¼æ€§ã‚’åˆ¤æ–­ã€‚

* **faceExpressionNet**
  ![3.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/506401/76559e4b-9a71-f906-c73a-6a30ca08f1e9.png)
  é¡”ã®è¡¨æƒ…ã®åˆ†é¡ã€‚ä»¥ä¸‹ã®è¡¨æƒ…ã§åˆ†é¡ã•ã‚Œã¾ã™ã€‚  
  neutral, happy, sad, angry, fearful, disgusted, surprised

* **ageGenderNet**
  ![4.jpeg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/506401/1dde1702-0f1c-94fd-3b97-4eb5e5f33708.jpeg)
  å¹´é½¢ã¨æ€§åˆ¥ã‚’æ¨å®šã€‚

## face-api.min.jsã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
face-api.jsã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæœ¬ä½“ã‚‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãŠãã¾ã™ã€‚  
ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰face-api.min.jsã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦projectãƒ•ã‚¡ã‚¤ãƒ«ç›´ä¸‹ã«é…ç½®ã—ã¾ã™ã€‚  
https://github.com/justadudewhohacks/face-api.js/tree/master/dist

## index.htmlã®ä½œæˆ
index.htmlã‚’ä½œæˆã—ã¾ã™ã€‚  
å¿…è¦ãªscriptã‚’èª­ã¿è¾¼ã‚“ã§ã€bodyã«videoã‚¿ã‚°ã‚’è¿½åŠ ã—ã¾ã™ã€‚  

```html: index.html
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <script defer src="face-api.min.js"></script>
    <script defer src="script.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: yellow;
      }

      canvas {
        position: absolute;
      }
    </style>
  </head>
  <body>
    <video id="video" width="720" height="560" autoplay muted></video>
  </body>
</html>

```

## script.jsã®ä½œæˆ
scriptã§ä½¿ç”¨ã—ãŸã„å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ã€å®Ÿéš›ã«ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚  
ç°¡å˜ãªèª¬æ˜ã‚’ã‚³ãƒ¼ãƒ‰ã®æ¨ªã«è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚  

```js: script.js
const video = document.getElementById("video");

Promise.all([
  faceapi.nets.tinyFaceDetector.loadFromUri("./models"), //ã‚«ãƒ¡ãƒ©ã®ä¸­ã®é¡”ã‚’æ¢ã™module
  faceapi.nets.faceLandmark68Net.loadFromUri("./models"), //ç›®ã€é¼»ã€å£ã‚’æ¢ã™module
  faceapi.nets.faceRecognitionNet.loadFromUri("./models"), //é¡”ä»˜ããƒœãƒƒã‚¯ã‚¹
  faceapi.nets.faceExpressionNet.loadFromUri("./models"), //è¡¨æƒ…ã‚’åˆ¤æ–­ã™ã‚‹module
  faceapi.nets.ageGenderNet.loadFromUri("./models"), //å¹´é½¢æ€§åˆ¥ã‚’åˆ¤æ–­ã™ã‚‹module
]).then(startVideo);

function startVideo() {
  navigator.mediaDevices
    .getUserMedia({ video: true })
    .then(function (stream) {
      video.srcObject = stream;
    })
    .catch(function (err) {
      console.error(err);
    });
}

video.addEventListener("play", () => {
  const canvas = faceapi.createCanvasFromMedia(video);
  document.body.append(canvas);
  const displaySize = { width: video.width, height: video.height };
  faceapi.matchDimensions(canvas, displaySize);
  setInterval(async () => {
    const detections = await faceapi
      .detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()) //ã‚«ãƒ¡ãƒ©ã®ä¸­ã«ã„ã‚‹é¡”ã‚’ã™ã¹ã¦èªè­˜
      .withFaceLandmarks() //ç›®ã€é¼»ã€å£ã‚’æ¢ã™
      .withFaceExpressions() ////è¡¨æƒ…ã‚’åˆ¤æ–­ã™ã‚‹
      .withAgeAndGender(); //å¹´é½¢æ€§åˆ¥ã‚’åˆ¤æ–­ã™ã‚‹
    const resizedDetections = faceapi.resizeResults(detections, displaySize);
    canvas.getContext("2d").clearRect(0, 0, canvas.width, canvas.height); //é¡”ã«ä»˜ã„ã¦å›ã‚‹ãƒœãƒƒã‚¯ã‚¹
    faceapi.draw.drawDetections(canvas, resizedDetections); //é¡”ã«ç®±ä»˜ãã®è¡¨ç¾
    faceapi.draw.drawFaceLandmarks(canvas, resizedDetections); //ç›®é¼»å£ç‚¹ç·šè¡¨ç¾
    faceapi.draw.drawFaceExpressions(canvas, resizedDetections); //æ„Ÿæƒ…æƒ…å ±è¡¨ç¾
    resizedDetections.forEach((detection) => {
      //å¹´é½¢ã€æ€§åˆ¥è¡¨ç¾ãƒœãƒƒã‚¯ã‚¹
      const box = detection.detection.box;
      const drawBox = new faceapi.draw.DrawBox(box, {
        label: Math.round(detection.age) + " year old " + detection.gender,
      });
      drawBox.draw(canvas);
    });
  }, 100);
});

```

## VSCodeã§å‹•ä½œç¢ºèªã™ã‚‹ãŸã‚ã«ä¾¿åˆ©ãªæ‹¡å¼µæ©Ÿèƒ½
å‹•ä½œç¢ºèªã™ã‚‹ãŸã‚ã«ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€VSCodeã®å ´åˆã¯æ‹¡å¼µæ©Ÿèƒ½ã®[LiveServer](https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer)ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  

ä½¿ç”¨æ–¹æ³•ã¯ä»¥ä¸‹å‚ç…§
https://webdesign-trends.net/entry/14461

# å‹•ä½œç¢ºèª
![demo.gif](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/506401/1b2a6bd1-0327-ee23-b81d-2d2b6cd5dcb9.gif)

å®Ÿéš›ã«å‹•ã‹ã—ã¦ã¿ã‚‹ã¨ã€é¡”ã‚’é’æ ã§èªè­˜ã—ã¦ã€æ ä¸Šéƒ¨ã«å¹´é½¢ã€æ ä¸‹éƒ¨ã«æ„Ÿæƒ…ã¨ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã€€ã€€
ã—ã£ã‹ã‚Šé¡”ã‚’æ¤œå‡ºã§ãã¦ã„ã¾ã™ã­ã€‚  

happy
![happy.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/506401/16eb6a73-5db8-1ffc-7a3c-5e2f2b8110d3.png)

angry
![angry.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/506401/8d9b3771-baa6-ff25-5814-d1a90673f66b.png)

disgusted
![disgusted.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/506401/064516dd-6a06-9c59-c38d-9750c6657b7d.png)

suprised
![suprised.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/506401/017faf6b-c5ab-e5a1-9cca-8bf4d64aeb0d.png)

# ãŠã‚ã‚Šã«
face-api.jsã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã¾ã›ã‚‹ã ã‘ã§é¡”èªè­˜ã‹ã‚‰è¡¨æƒ…ãŸå¹´é½¢ã‚’å‰²ã‚Šå‡ºã™ã“ã¨ãŒã§ãã¾ã—ãŸã€‚  
ã“ã‚Œã§ä»–äººã‹ã‚‰ã¿ã¦è‡ªåˆ†ã®è¡¨æƒ…ãŒã©ã†è¦‹ãˆã¦ã„ã‚‹ã‹ãŒã‚ã‹ã‚Šã¾ã™ã­ã€‚ã“ã‚Œã§å¤œã‚‚å®‰å¿ƒã—ã¦çœ ã‚Œãã†ã§ã™ã€‚    
ã—ã‹ã‚‚æ¤œå‡ºã•ã‚ŒãŸå¹´é½¢ãŒå®Ÿå¹´é½¢ã‚ˆã‚Šä½ã‚ãªã®ã‚‚ã„ã„ã§ã™ã­ã€‚ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ä¸ŠãŒã‚Šã¾ã™ã€‚  
å¹´é½¢ãŒä½ã‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ã®ã¯ã€å¤§å…ƒã®å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã«ã‚¢ã‚¸ã‚¢ç³»ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ãŒå°‘ãªã„ã‹ã‚‰ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“(ã‚¢ã‚¸ã‚¢ç³»ã®äººã¯æ¬§ç±³ç³»ã®äººã‚ˆã‚Šå¹´é½¢ãŒè‹¥ãè¦‹ã‚‰ã‚Œã‚‹ã¿ãŸã„ãªã®ã§)  

ä»Šå›ã¯å‹•ç”»ã‹ã‚‰é¡”ã‚’æ¤œå‡ºã—ã¦æ„Ÿæƒ…ã‚„å¹´é½¢ã‚’å‡ºã—ã¾ã—ãŸãŒã€ç”»åƒã‹ã‚‰æ¤œå‡ºã—ãŸã‚Šä»–ã®å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§è‰²ã€…ãªã“ã¨ãŒã§ããã†ã§ã™ã€‚  

# å‚è€ƒ
* [fase-api.js](https://justadudewhohacks.github.io/face-api.js/docs/index.html)
* [FaceAPIã§ã‚ã£ã•ã‚Šé¡”èªè­˜](https://zenn.dev/sdkfz181tiger/articles/3b03385165d4f2)

